<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>äº®å±è¡ŒåŠ¨</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
/* å¼ºåˆ¶åœ°å›¾æ’‘æ»¡å…¨å±ï¼ŒèƒŒæ™¯è®¾ä¸ºæ·±è“è‰²ï¼Œé˜²æ­¢ç™½å±æŠ¥é”™ */
body, html, #map { margin: 0; padding: 0; height: 100vh; width: 100vw; background: #000b1a; }
.ui-panel { position: fixed; z-index: 9999; bottom: 20px; left: 50%; transform: translateX(-50%); }
button { padding: 15px 30px; cursor: pointer; border-radius: 50px; border: none; background: #ff416c; color: white; font-weight: bold; font-size: 18px; box-shadow: 0 0 20px rgba(255,65,108,0.5); }
.pic { border: 2px solid white; width: 50px; height: 50px; object-fit: cover; }
</style>
</head>
<body>

<div id="map"></div>
<div class="ui-panel">
<button onclick="document.getElementById('fileIn').click()">ç‚¹è¿™é‡Œä¸Šä¼ ç…§ç‰‡</button>
</div>
<input type="file" id="fileIn" accept="image/*" style="display:none">

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>

<script>
// ğŸš© åªè¦æ”¹è¿™é‡Œï¼ç¡®ä¿å¼•å·é‡Œä¸è¦æœ‰ç©ºæ ¼
const SB_URL = 'https://pzgyvnpbnvxciruqflya.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6Z3l2bnBibnZ4Y2lydXFmbHlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4ODAzNDAsImV4cCI6MjA4NzQ1NjM0MH0.WamSJoWx2-FSs-QfDZ4rZkhgLOqc-W4VpBmYphAkwsk';

const _db = supabase.createClient(SB_URL, SB_KEY);

// åˆå§‹åŒ–åœ°å›¾ï¼šåªè¦è¿™ä¸€è¡Œè·‘é€šï¼Œå±å¹•å°±ä¸€å®šä¼šäº®
var map = L.map('map', { zoomControl: false }).setView([30, 110], 4);
L.tileLayer('https://{s}.tile.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

// åŠ è½½æ•°æ®
async function init() {
const { data } = await _db.from('footprints').select('*');
if(data) {
data.forEach(p => {
const icon = L.divIcon({ html: `<img src="${p.img_url}" class="pic">`, iconSize: [50, 50] });
L.marker([p.lat, p.lng], {icon: icon}).addTo(map);
});
}
}
init();

// ä¸Šä¼ ä¸€å¼ è¯•è¯•
document.getElementById('fileIn').onchange = function(e) {
const file = e.target.files[0];
const reader = new FileReader();
reader.onload = function(ev) {
EXIF.getData(file, async function() {
const lat = EXIF.getTag(this, "GPSLatitude");
const lon = EXIF.getTag(this, "GPSLongitude");
if (lat && lon) {
const latN = lat[0] + lat[1]/60 + lat[2]/3600;
const lonN = lon[0] + lon[1]/60 + lon[2]/3600;
await _db.from('footprints').insert([{ lat: latN, lng: lonN, img_url: ev.target.result, user_id: 'me' }]);
location.reload();
} else {
alert("ç…§ç‰‡æ²¡å¸¦åœ°å€ï¼Œæ¢ä¸€å¼ è¯•è¯•ï¼");
}
});
};
reader.readAsDataURL(file);
};
</script>
</body>
</html>
