<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>云端足迹博物馆</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
body { margin:0; padding:0; background: #000b1a; color: white; }
#map { height:100vh; width:100%; }
.ui-panel { position:fixed; z-index:9999; bottom:30px; left:50%; transform:translateX(-50%); text-align:center; }
button { padding: 15px 30px; background: linear-gradient(135deg, #00f2fe, #4facfe); color: white; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(79, 172, 254, 0.6); }
.photo-marker { border: 2px solid #fff; border-radius: 8px; width:60px; height:60px; object-fit:cover; }
</style>
</head>
<body>

<div id="map"></div>
<div class="ui-panel"><button onclick="document.getElementById('fileIn').click()">上传足迹 & 同步云端</button></div>
<input type="file" id="fileIn" accept="image/*" multiple style="display:none">

<script>
// --- 终极配置区 ---
const SUPABASE_URL = 'https://pzgyvnpbnvxciruqflya.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6Z3l2bnBibnZ4Y2lydXFmbHlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4ODAzNDAsImV4cCI6MjA4NzQ1NjM0MH0.WamSJoWx2-FSs-QfDZ4rZkhgLOqc-W4VpBmYphAkwsk';

// 老师提醒：这里用了标准的创建方式
const { createClient } = supabase;
const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// 先让地图出来，不要等云端数据
var map = L.map('map', { zoomControl: false }).setView([30, 105], 4);
L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}').addTo(map);

console.log("地图加载成功！正在连接云端...");

// 异步加载云端数据，不影响地图显示
async function loadHistory() {
try {
let { data, error } = await _supabase.from('footprints').select('*');
if (error) throw error;
if (data) data.forEach(p => addMarkerToMap(p));
console.log("云端数据同步完成");
} catch (err) {
console.error("云端连接失败，但不影响使用本地上传:", err);
}
}
loadHistory();

// ... 后面的上传函数保持不变 ...
</script>

</body>
</html>
